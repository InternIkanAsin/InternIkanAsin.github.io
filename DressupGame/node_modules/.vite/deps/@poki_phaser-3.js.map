{
  "version": 3,
  "sources": ["../../@poki/phaser-3/dist/phaser-poki.js"],
  "sourcesContent": ["var $gvRdH$phaser = require(\"phaser\");\r\n\r\nfunction $parcel$exportWildcard(dest, source) {\r\n  Object.keys(source).forEach(function(key) {\r\n    if (key === 'default' || key === '__esModule' || dest.hasOwnProperty(key)) {\r\n      return;\r\n    }\r\n\r\n    Object.defineProperty(dest, key, {\r\n      enumerable: true,\r\n      get: function get() {\r\n        return source[key];\r\n      }\r\n    });\r\n  });\r\n\r\n  return dest;\r\n}\r\nfunction $parcel$export(e, n, v, s) {\r\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\r\n}\r\nvar $66a613ab66341f23$exports = {};\r\n\r\n$parcel$export($66a613ab66341f23$exports, \"EVENT_INITIALIZED\", () => $66a613ab66341f23$export$7d17243235f36b85);\r\n$parcel$export($66a613ab66341f23$exports, \"PokiPlugin\", () => $66a613ab66341f23$export$176a0ece5b97d00d);\r\n\r\nconst $66a613ab66341f23$export$7d17243235f36b85 = \"poki:initialized\";\r\nclass $66a613ab66341f23$export$176a0ece5b97d00d extends (0, $gvRdH$phaser.Plugins).BasePlugin {\r\n    init({ loadingSceneKey: loadingSceneKey , gameplaySceneKey: gameplaySceneKey , autoCommercialBreak: autoCommercialBreak  }) {\r\n        this._loadingSceneKey = loadingSceneKey;\r\n        this._gameplaySceneKey = gameplaySceneKey;\r\n        this._autoCommercialBreak = autoCommercialBreak;\r\n        this._scriptLoaded = false;\r\n        this._initializeHooks = [];\r\n        this._queue = [];\r\n        this.initialized = false;\r\n        this.hasAdblock = true;\r\n        const script = document.createElement(\"script\");\r\n        script.setAttribute(\"type\", \"text/javascript\");\r\n        script.setAttribute(\"src\", \"https://game-cdn.poki.com/scripts/v2/poki-sdk.js\");\r\n        script.addEventListener(\"load\", ()=>{\r\n            this.sdk = window.PokiSDK;\r\n            this._scriptLoaded = true;\r\n            this._queue.forEach((f)=>f());\r\n            this.sdk.init().then(()=>{\r\n                this.initialized = true;\r\n                this.hasAdblock = false;\r\n                this.game.events.emit($66a613ab66341f23$export$7d17243235f36b85, this);\r\n                this._initializeHooks.forEach((f)=>f(this));\r\n                this._initializeHooks = undefined;\r\n            }).catch((err)=>{\r\n                console.error(\"PokiSDK failed\", err);\r\n                this.initialized = true;\r\n                this.hasAdblock = true;\r\n                this.game.events.emit($66a613ab66341f23$export$7d17243235f36b85, this);\r\n                this._initializeHooks.forEach((f)=>f(this));\r\n                this._initializeHooks = undefined;\r\n            });\r\n        });\r\n        script.addEventListener(\"error\", (e)=>{\r\n            console.error(\"failed to load PokiSDK\", e);\r\n        });\r\n        document.head.appendChild(script);\r\n        this._currentScenes = [];\r\n    }\r\n    runWhenInitialized(callback) {\r\n        if (this.initialized) callback(this) // eslint-disable-line node/no-callback-literal\r\n        ;\r\n        else this._initializeHooks.push(callback);\r\n    }\r\n    // Called by Phaser, do not use\r\n    start() {\r\n        this.game.events.on(\"step\", this._update, this);\r\n    }\r\n    // Called by Phaser, do not use\r\n    stop() {\r\n        this.game.events.off(\"step\", this._update);\r\n    }\r\n    _update() {\r\n        // Detect if new actives scenes are added or removed:\r\n        const names = this.game.scene.getScenes(true).map((s)=>s.constructor.name);\r\n        this._currentScenes.forEach((name)=>{\r\n            if (names.indexOf(name) === -1) {\r\n                this._currentScenes.splice(this._currentScenes.indexOf(name), 1);\r\n                if (name === this._loadingSceneKey) this.gameLoadingFinished();\r\n                if (name === this._gameplaySceneKey) this.gameplayStop();\r\n            }\r\n        });\r\n        names.forEach((name)=>{\r\n            if (this._currentScenes.indexOf(name) === -1) {\r\n                this._currentScenes.push(name);\r\n                if (name === this._loadingSceneKey) this.gameLoadingStart();\r\n                if (name === this._gameplaySceneKey) {\r\n                    if (this._scriptLoaded && this._autoCommercialBreak && !this.hasAdblock) this.commercialBreak().then(()=>{\r\n                        this.gameplayStart();\r\n                    });\r\n                    else this.gameplayStart();\r\n                }\r\n            }\r\n        });\r\n    }\r\n    // Manually call the gameLoadedStart event in the PokiSDK, this is done\r\n    // automatically if you've set the loadingSceneKey in the plugin data.\r\n    gameLoadingStart() {\r\n        if (this._scriptLoaded) this.sdk.gameLoadingStart();\r\n        else this._queue.push(()=>{\r\n            this.sdk.gameLoadingStart();\r\n        });\r\n    }\r\n    // Manually call the gameLoadingFinished event in the PokiSDK, this is done\r\n    // automatically if you've set the loadingSceneKey in the plugin data.\r\n    gameLoadingFinished() {\r\n        if (this._scriptLoaded) this.sdk.gameLoadingFinished();\r\n        else this._queue.push(()=>{\r\n            this.sdk.gameLoadingFinished();\r\n        });\r\n    }\r\n    // Manually call the gameplayStart event in the PokiSDK, this is done\r\n    // automatically if you've set the gameplaySceneKey in the plugin data.\r\n    gameplayStart() {\r\n        if (this._scriptLoaded) this.sdk.gameplayStart();\r\n        else this._queue.push(()=>{\r\n            this.sdk.gameplayStart();\r\n        });\r\n    }\r\n    // Manually call the gameplayStop event in the PokiSDK, this is done\r\n    // automatically if you've set the gameplaySceneKey in the plugin data.\r\n    gameplayStop() {\r\n        if (this._scriptLoaded) this.sdk.gameplayStop();\r\n        else this._queue.push(()=>{\r\n            this.sdk.gameplayStop();\r\n        });\r\n    }\r\n    // Manually request a commercialBreak via the PokiSDK, this is done\r\n    // automatically if you've set autoCommercialBreak to true in the plugin data\r\n    // and the configured gameplayScene started/resumed.\r\n    commercialBreak() {\r\n        return this._break(\"commercial\");\r\n    }\r\n    // Trigger a rewardedBreak via the PokiSDK when called.\r\n    rewardedBreak() {\r\n        return this._break(\"rewarded\");\r\n    }\r\n    _break(type) {\r\n        if (type !== \"commercial\" && type !== \"rewarded\") throw new Error('type must be \"commercial\" or \"rewarded\"');\r\n        if (this.initialized && !this.hasAdblock) return new Promise((resolve)=>{\r\n            const wasKeyboardEnbaled = this.game.input.keyboard.enabled;\r\n            this.game.input.keyboard.enabled = false;\r\n            const wasMuted = this.game.sound.mute;\r\n            this.game.sound.mute = true;\r\n            this.sdk[`${type}Break`]().then((success)=>{\r\n                if (wasKeyboardEnbaled) this.game.input.keyboard.enabled = true;\r\n                if (!wasMuted) this.game.sound.mute = false;\r\n                resolve(success);\r\n            });\r\n        });\r\n        return Promise.resolve(false);\r\n    }\r\n}\r\n\r\n\r\n$parcel$exportWildcard(module.exports, $66a613ab66341f23$exports);\r\n\r\n\r\n//# sourceMappingURL=phaser-poki.js.map\r\n"],
  "mappings": "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",
  "names": []
}
